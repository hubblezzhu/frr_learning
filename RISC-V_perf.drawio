<mxfile host="app.diagrams.net" modified="2024-05-22T02:28:05.545Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36" etag="OSWVYb7iogPycw5VIRU6" version="24.3.1" type="github">
  <diagram name="第 1 页" id="Fk42mJiVpBC5FdkMqB4c">
    <mxGraphModel dx="1907" dy="1891" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" edge="1" parent="1" source="S7xizqJS5x5Z0-ZJpoZf-1" target="S7xizqJS5x5Z0-ZJpoZf-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-1" value="riscv_pmu_alloc" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="110" y="230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-2" value="&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;pmu-&amp;gt;pmu = (struct pmu) {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.event_init&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;= riscv_pmu_event_init,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.event_mapped&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;= riscv_pmu_event_mapped,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.event_unmapped&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;= riscv_pmu_event_unmapped,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.event_idx&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;= riscv_pmu_event_idx,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.add&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;= riscv_pmu_add,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.del&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;= riscv_pmu_del,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.start&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;= riscv_pmu_start,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.stop&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;= riscv_pmu_stop,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;.read&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;= riscv_pmu_read,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;};&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="110" y="405" width="420" height="180" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-7" value="tools/perf/arch/riscv&lt;div&gt;tools/perf/arch/riscv64&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tools/perf/pmu-events/arch/riscv&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-480" y="-750" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-8" value="drivers/perf/riscv_pmu.c&lt;div&gt;drivers/perf/riscv_pmu_sbi.c&lt;/div&gt;&lt;div&gt;drivers/perf/riscv_pmu_legacy.c&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-480" y="-850" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-9" value="include/linux/perf/riscv_pmu.h" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-480" y="-940" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-10" value="arch/riscv/include/asm/sbi.h" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-480" y="-1030" width="280" height="70" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-11" value="&lt;font face=&quot;Comic Sans MS&quot; style=&quot;font-size: 17px;&quot;&gt;RISC-V Perf code&lt;/font&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=17;" vertex="1" parent="1">
          <mxGeometry x="-500" y="-1100" width="160" height="30" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-12" value="&lt;div&gt;&lt;div&gt;arch/riscv/include/asm/hwcap.h&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;arch/riscv/include/asm/kvm_host.h&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;arch/riscv/include/asm/kvm_vcpu_pmu.h&lt;/div&gt;arch/riscv/include/asm/kvm_vcpu_sbi.h&lt;/div&gt;&lt;div&gt;&lt;div&gt;arch/riscv/include/asm/sbi.h&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch/riscv/kvm/vcpu_pmu.c&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch/riscv/kvm/vcpu_sbi_pmu.c&lt;div&gt;arch/riscv/kvm/vcpu_sbi_replace.c&lt;br class=&quot;Apple-interchange-newline&quot;&gt;arch/riscv/kvm/vcpu_sbi.c&lt;br class=&quot;Apple-interchange-newline&quot;&gt;arch/riscv/kvm/vcpu.c&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-100" y="-1030" width="280" height="230" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-13" value="&lt;div&gt;struct riscv_pmu {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct pmu&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;pmu;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;char&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;*name;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;irqreturn_t&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;(*handle_irq)(int irq_num, void *dev);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;unsigned long&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;cmask;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;u64&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_read)(struct perf_event *event);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_get_idx)(struct perf_event *event);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_get_width)(int idx);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_clear_idx)(struct perf_event *event);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_start)(struct perf_event *event, u64 init_val);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*ctr_stop)(struct perf_event *event, unsigned long flag);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*event_map)(struct perf_event *event, u64 *config);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*event_init)(struct perf_event *event);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*event_mapped)(struct perf_event *event, struct mm_struct *mm);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;void&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*event_unmapped)(struct perf_event *event, struct mm_struct *mm);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;uint8_t&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;(*csr_index)(struct perf_event *event);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct cpu_hw_events&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;__percpu *hw_events;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct hlist_node&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;node;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct notifier_block&amp;nbsp; &amp;nbsp;riscv_pm_nb;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-540" y="90" width="500" height="360" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-14" value="&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;include/linux/perf_event.h&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;struct pmu {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-540" y="480" width="500" height="120" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-18" value="riscv_pmu_start" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="90" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-19" value="riscv_pmu_stop" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="360" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-20" value="riscv_pmu_add" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-320" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-21" value="riscv_pmu_del" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-120" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="S7xizqJS5x5Z0-ZJpoZf-22" target="S7xizqJS5x5Z0-ZJpoZf-23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-22" value="riscv_pmu_read" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="650" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-23" value="riscv_pmu_event_update" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="650" y="830" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-25" value="&lt;div&gt;/* PMU data structure per vcpu */&lt;/div&gt;&lt;div&gt;struct kvm_pmu {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_pmc pmc[RISCV_KVM_MAX_COUNTERS];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_fw_event fw_event[RISCV_KVM_MAX_FW_CTRS];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* Number of the virtual firmware counters available */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int num_fw_ctrs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* Number of the virtual hardware counters available */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int num_hw_ctrs;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* A flag to indicate that pmu initialization is done */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;bool init_done;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* Bit map of all the virtual counter used */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;DECLARE_BITMAP(pmc_in_use, RISCV_KVM_MAX_COUNTERS);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* Bit map of all the virtual counter overflown */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;DECLARE_BITMAP(pmc_overflown, RISCV_KVM_MAX_COUNTERS);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* The address of the counter snapshot area (guest physical address) */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;gpa_t snapshot_addr;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/* The actual data of the snapshot */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct riscv_pmu_snapshot_data *sdata;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="1000" y="190" width="460" height="310" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-26" value="&lt;div&gt;struct kvm_vcpu {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm *kvm;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_PREEMPT_NOTIFIERS&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct preempt_notifier preempt_notifier;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int cpu;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int vcpu_id; /* id given by userspace at creation */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int vcpu_idx; /* index into kvm-&amp;gt;vcpu_array */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int ____srcu_idx; /* Don&#39;t use this directly.&amp;nbsp; You&#39;ve been warned. */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_PROVE_RCU&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int srcu_depth;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mode;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;u64 requests;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;unsigned long guest_debug;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct mutex mutex;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_run *run;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#ifndef __KVM_HAVE_ARCH_WQP&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct rcuwait wait;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct pid __rcu *pid;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int sigset_active;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;sigset_t sigset;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;unsigned int halt_poll_ns;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;bool valid_wakeup;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_HAS_IOMEM&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mmio_needed;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mmio_read_completed;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mmio_is_write;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mmio_cur_fragment;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;int mmio_nr_fragments;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_mmio_fragment mmio_fragments[KVM_MAX_MMIO_FRAGMENTS];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_KVM_ASYNC_PF&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;u32 queued;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;struct list_head queue;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;struct list_head done;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;spinlock_t lock;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;} async_pf;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;#ifdef CONFIG_HAVE_KVM_CPU_RELAX_INTERCEPT&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * Cpu relax intercept or pause loop exit optimization&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * in_spin_loop: set when a vcpu does a pause loop exit&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; *&amp;nbsp; or cpu relax intercepted.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * dy_eligible: indicates whether vcpu is eligible for directed yield.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;bool in_spin_loop;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;bool dy_eligible;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;} spin_loop;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;#endif&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;bool preempted;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;bool ready;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_vcpu_arch arch;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_vcpu_stat stat;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;char stats_id[KVM_STATS_NAME_SIZE];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_dirty_ring dirty_ring;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * The most recently used memslot by this vCPU and the slots generation&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * for which it is valid.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * No wraparound protection is needed since generations won&#39;t overflow in&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * thousands of years, even assuming 1M memslot operations per second.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct kvm_memory_slot *last_used_slot;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;u64 last_used_slot_gen;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="1000" y="580" width="520" height="1110" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-27" value="Perf Event" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=48;fontFamily=Comic Sans MS;" vertex="1" parent="1">
          <mxGeometry x="-710" y="1300" width="260" height="90" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-28" value="&lt;div&gt;inlcude/linux/perf_event.h&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/**&lt;/div&gt;&lt;div&gt;&amp;nbsp;* struct perf_event - performance event kernel representation:&lt;/div&gt;&lt;div&gt;&amp;nbsp;*/&lt;/div&gt;&lt;div&gt;struct perf_event {&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;struct perf_event_attr&#x9;&#x9;attr;&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: initial;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;struct hw_perf_event&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;hw;&lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-690" y="1430" width="600" height="260" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-29" value="&lt;div&gt;include/uapi/linux/perf_event.h&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;/*&lt;/div&gt;&lt;div&gt;&amp;nbsp;* Hardware event_id to monitor via a performance monitoring event:&lt;/div&gt;&lt;div&gt;&amp;nbsp;*&lt;/div&gt;&lt;div&gt;&amp;nbsp;* @sample_max_stack: Max number of frame pointers in a callchain,&lt;/div&gt;&lt;div&gt;&amp;nbsp;*&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; should be &amp;lt; /proc/sys/kernel/perf_event_max_stack&lt;/div&gt;&lt;div&gt;&amp;nbsp;*/&lt;/div&gt;&lt;div&gt;struct perf_event_attr {&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;/*&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; * Major type: hardware/software/tracepoint/etc.&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;__u32&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;type;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-690" y="1730" width="600" height="280" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-30" value="&lt;div&gt;include/uapi/linux/perf_event.h&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;/*&lt;/div&gt;&lt;div&gt;&amp;nbsp;* attr.type&lt;/div&gt;&lt;div&gt;&amp;nbsp;*/&lt;/div&gt;&lt;div&gt;enum perf_type_id {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_HARDWARE&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;= 0,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_SOFTWARE&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;= 1,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_TRACEPOINT&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;= 2,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_HW_CACHE&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;= 3,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_RAW&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;= 4,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_BREAKPOINT&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&lt;/span&gt;= 5,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;PERF_TYPE_MAX,&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&#x9;&#x9;&#x9;&lt;/span&gt;/* non-ABI */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;};&lt;/div&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-690" y="2058" width="360" height="302" as="geometry" />
        </mxCell>
        <mxCell id="S7xizqJS5x5Z0-ZJpoZf-31" value="&lt;ul style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent; background-color: rgb(255, 255, 255);&quot;&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot; face=&quot;Comic Sans MS&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Hardware Event&lt;/span&gt;：CPU 性能计数器（performance monitoring counters）&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot; face=&quot;Comic Sans MS&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Software event&lt;/span&gt;：内核计数器事件&lt;/font&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Hardware cache event&lt;/span&gt;：CPU Cache 事件&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Kernel PMU event&lt;/span&gt;：Performance Monitoring Unit (PMU) 事件&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Tracepoint event&lt;/span&gt;：包含了静态和动态代码追踪事件&lt;ul style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;Kernel tracepoints&lt;/span&gt;：在 kernel 中关键位置的静态追踪代码&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;kprobes&lt;/span&gt;：在内核中的任意位置动态地被插入追踪代码&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;uprobes&lt;/span&gt;：与kprobes类似，但用于用户空间。动态地在应用程序和库中的任意位置插入追踪代码&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;&lt;span style=&quot;box-sizing: border-box; scrollbar-width: auto; scrollbar-color: var(--scrollbar-thumb)transparent;&quot;&gt;USDT&lt;/span&gt;：是 tracepoints 在用户空间的对应技术，是应用程序和库在它们的代码中提前加入的静态追踪代码&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;" style="rounded=0;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;fontFamily=Comic Sans MS;align=left;" vertex="1" parent="1">
          <mxGeometry x="-260" y="2113" width="680" height="192" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
